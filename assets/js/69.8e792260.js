(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{470:function(t,a,s){"use strict";s.r(a);var e=s(2),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"tree-shaking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking"}},[t._v("#")]),t._v(" Tree shaking")]),t._v(" "),a("p",[a("code",[t._v("Tree shaking")]),t._v(" 是一种通过清除多余代码方式来优化项目打包体积的技术,也就是说 ，tree shaking 其实是找出使用的代码")]),t._v(" "),a("p",[t._v("Tree shaking是基于ES6模板语法（import与exports），主要是借助ES6模块的"),a("strong",[t._v("静态编译")]),t._v("思想，在编译时就能确定模块的依赖关系，以及输入和输出的变量")]),t._v(" "),a("p",[t._v("它做了两件事")]),t._v(" "),a("ul",[a("li",[t._v("编译阶段利用"),a("code",[t._v("ES6 Module")]),t._v("判断哪些模块已经加载")]),t._v(" "),a("li",[t._v("判断那些模块和变量未被使用或者引用，进而删除对应代码")])]),t._v(" "),a("h2",{attrs:{id:"好处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#好处"}},[t._v("#")]),t._v(" 好处")]),t._v(" "),a("p",[t._v("减少程序体积（更小）\n减少程序执行时间（更快）\n便于将来对程序架构进行优化（更友好")]),t._v(" "),a("h2",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[t._v("#")]),t._v(" 原理")]),t._v(" "),a("p",[t._v("因为tree shaking只能在静态modules下工作。ECMAScript 6 模块加载是静态的,因此整个依赖树可以被静态地推导出解析语法树。所以在 ES6 中使用 tree shaking 是非常容易的。")]),t._v(" "),a("p",[t._v("Webpack 中，Tree-shaking 的实现一是先标记出模块导出值中哪些没有被用过，二是使用 Terser 删掉这些没被用到的导出语句。标记过程大致可划分为三个步骤：")]),t._v(" "),a("ol",[a("li",[t._v("Make 阶段，收集模块导出变量并记录到模块依赖关系图 ModuleGraph 变量中")]),t._v(" "),a("li",[t._v("Seal 阶段，遍历 ModuleGraph 标记模块导出变量有没有被使用")]),t._v(" "),a("li",[t._v("生成产物时，若变量没有被其它模块使用则删除对应的导出语句")])]),t._v(" "),a("blockquote",[a("p",[t._v("标记功能需要配置 optimization.usedExports = true 开启")])]),t._v(" "),a("p",[t._v("链接：https://juejin.cn/post/7002410645316436004")]),t._v(" "),a("h2",{attrs:{id:"webpack开启tree-shaking的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack开启tree-shaking的配置"}},[t._v("#")]),t._v(" webpack开启tree-shaking的配置")]),t._v(" "),a("p",[t._v("在 Webpack 中，启动 Tree Shaking 功能必须同时满足三个条件：")]),t._v(" "),a("ul",[a("li",[t._v("使用 ESM 规范编写模块代码")]),t._v(" "),a("li",[t._v("webpack配置optimization.usedExports为true,启动标记功能。")]),t._v(" "),a("li",[t._v("启动代码优化功能，可以通过如下方式之一即可实现:")])]),t._v(" "),a("p",[t._v("配置 mode = production\n配置 optimization.minimize = true\n提供 optimization.minimizer 数组")]),t._v(" "),a("p",[t._v("例如：")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n  module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./src/index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"production"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("devtool")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("optimization")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("usedExports")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("链接："),a("a",{attrs:{href:"https://juejin.cn/post/7039547628379439135",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.cn/post/7039547628379439135"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);